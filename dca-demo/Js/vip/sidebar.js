(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'");}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var nsAssetMod={init:function(){var _this=this;_this.asset.init();
_this.assetCnt.init()},asset:{ajaxUrl:{coupon:"http://coupon.myopen.vip.com/coupon/suggestvouchers"},ajaxData:{coupon:{getcount:1,_callback:"coupon",_cache:false,_localCache:true,_localCacheTime:3*60}},ajaxCb:{coupon:"couponCb"},init:function(){var assetTip=$.Storage.get("sidebarcom-asset-tip-have");var RUID=$.Cookie.get("VipRUID");var T=new Date;var D=T.getDate();this.subEvent();if(nsSideBar.util.chkLogin()&&assetTip[RUID]!=D)nsSideBar.util.ajax(this)},subEvent:function(){var _this=this;nsSideBar.util.sub("sidebarAssetInit",
_this)},sidebarAssetInit:function(re){var html=$("#J_asset_cnt").html(),$container=re.container;$container.html(html).find(".J_pop_bd").addClass("sidebarcom-loading")},couponCb:function(data){$.Listeners.pub("couponCount").success({couponCount:data});if(data.code!=0)nsSideBar.util.ajaxRmCache(this)},apiSwitchs:{coupon:1}},assetCnt:{el:"#J_wrap",events:{"click #J_asset_close":"hideAsset","click .J_asset_error":"refresh"},ajaxUrl:{coupon:"http://coupon.myopen.vip.com/coupon/suggestvouchers"},ajaxData:{coupon:{_callback:"coupon",
_cache:false,_localCache:true,_localCacheTime:3*60}},ajaxCb:{coupon:"couponCb,errorCb"},apiSwitchs:{coupon:1},init:function(){nsSideBar.util.bindEvent(this);nsSideBar.util.sub("assetPop",this);nsSideBar.util.sub("noCoupon",this);nsSideBar.util.sub("haveCoupon",this);this.createAd()},hideAsset:function(){$.Listeners.pub("closeSidebarPop").success()},assetPop:function(){var that=this;nsSideBar.util.ajax(that)},couponCb:function(data){var _this=this;if(data.code==1){nsSideBar.util.chkLogin("#J_asset",
true);nsSideBar.util.ajaxRmCache(this);return false}if(data.code!=0&&!data.data.length){this.errorCb();return false}_this.couponData=data.data;_this.expireCoupon=_this.couponData.pmsCoupon.recent_expire,_this.currentCoupon=_this.couponData.pmsCoupon.my,_this.unusableCoupon=_this.couponData.pmsCoupon.unusable;if(!_this.expireCoupon.length&&(!_this.currentCoupon.length&&!_this.unusableCoupon.length))nsSideBar.util.pub("noCoupon");else nsSideBar.util.pub("haveCoupon")},noCoupon:function(){var html=$("#J_asset_null_tpl").html(),
bd=nsSideBar.util.bd();bd.html(html);$.Listeners.pub("sideBarAssetFirstOpen").success($("#J_asset_null"));nsSideBar.util.scrollBar()},haveCoupon:function(){var _this=this,processedCouponData=_this.process(),bd=nsSideBar.util.bd(),html=$("#J_asset_have_tpl").html(),couponTpl=$("#J_coupon_tpl"),couponHtml=null;nsSideBar.util.done();bd.append(html);couponHtml=bd.Template({templateElement:couponTpl,replace:null}).Template("process",{data:processedCouponData,total:_this.couponData.pmsCoupon.total});$("#J_asset_list").append(couponHtml);
$.Listeners.pub("sideBarAssetFirstOpen").success($("#J_asset_have"));this.mars();nsSideBar.util.scrollBar()},createAd:function(){if(!!$.Cookie.get("VipLID")){var ruid=$.Cookie.get("VipRUID"),actCoupon=$.Cookie.get("actCoupon_"+ruid),now=(new Date).valueOf(),isInRangeA=now>=14343336E5&&now<=14345928E5,isInRangeB=now>=14345928E5&&now<=14346792E5;if(actCoupon!=1&&(isInRangeA||isInRangeB))$("#J_asset").prepend('<i id="J_asset_point" class="i-sidebarcom-brand-tips"></i>');if(actCoupon!=1&&isInRangeA)$.Listeners.sub("sideBarAssetFirstOpen").onsuccess(function($target){$target.prepend('<a href="http://act.vip.com/10586.html" target="_blank" class="asset-cpn-hb"><img src="http://a.vpimg4.com/upload/actpics/act/2015/sidebar0618/ad_warm.jpg" width="237"></a>')});
else if(actCoupon!=1&&isInRangeB)$.Listeners.sub("sideBarAssetFirstOpen").onsuccess(function($target){$target.prepend('<a href="http://act.vip.com/10586.html" target="_blank" class="asset-cpn-hb"><img src="http://a.vpimg4.com/upload/actpics/act/2015/sidebar0618/ad_open.jpg" width="237"></a>')})}},process:function(){var _this=this,i=0,j=0,unusableLen=_this.unusableCoupon.length;for(;i<unusableLen;i++){var unusableCoupon=_this.unusableCoupon[i];unusableCoupon.expire_desc="\u672a\u5230\u6709\u6548\u671f";
unusableCoupon.coupon_display="asset-cpn-feature"}var couponArray=_this.expireCoupon.concat(_this.currentCoupon,_this.unusableCoupon);var len=couponArray.length,rtData=[];for(;j<len;j++){var obj=couponArray[j],tmp={},uselimit="",usemoney="",begin_time=obj.begin_time,end_time=obj.end_time,is_onlinePay=[],is_coupon=[],is_brands=[],is_mobile=[];if(obj.coupon_type!=4){uselimit=obj.use_limit;usemoney=obj.coupon_fav}begin_time=nsSideBar.util.timeToStr(begin_time);end_time=nsSideBar.util.timeToStr(end_time);
if($.inArray("2",obj.coupon_platform)!=-1&&$.inArray("1",obj.coupon_platform)==-1)is_mobile=["1"];else if(obj.brands&&obj.brands.length){for(var k=0,jLen=obj.brands.length;k<jLen;k++)obj.brands[k].num=k+1;is_brands=is_brands.concat(obj.brands)}else if(obj.coupon_range&&obj.coupon_range.length){var couponRange=[];for(var k=0,rangeLen=obj.coupon_range.length;k<rangeLen;k++)couponRange.push(obj.coupon_range[k].name);is_coupon=[{"couponRange":couponRange}]}if(obj.onlinepay&&obj.onlinepay==1)is_onlinePay=
[{"text":"\u9650\u5728\u7ebf\u652f\u4ed8"}];tmp.is_not_free=obj.coupon_type==4?[]:[{"usemoney":usemoney,"uselimit":uselimit}];tmp.is_free=obj.coupon_type==4?["1"]:[];tmp.is_expire_desc=obj.expire_desc?[{"expire_desc":obj.expire_desc}]:[];tmp.is_time=begin_time?[{"start_time":begin_time,"stop_time":end_time}]:[];tmp.is_brands=is_brands;tmp.is_coupon=is_coupon;tmp.is_mobile=is_mobile;tmp.is_onlinePay=is_onlinePay;tmp.coupon_display=obj.coupon_display?obj.coupon_display:"";rtData.push(tmp)}return rtData},
fixLink:function(){var bd=nsSideBar.util.bd();bd.find(".J_asset_cpn").each(function(i,n){var nameDom=$(this).find(".J_coupon_name_link");var name=nameDom.html();var link=nameDom.attr("href");if(name!="")$(this).find(".J_coupon_link").attr("href",link)})},refresh:function(e){var that=e.data;var bd=nsSideBar.util.bd();bd.addClass("sidebarcom-loading");bd.children().hide();nsSideBar.util.ajaxRmCache(that,"coupon");setTimeout(function(){nsSideBar.util.pub("assetPop")},1)},errorCb:function(){var bd=nsSideBar.util.bd();
var link="http://my.vip.com/coupon/coupon.php";var html=$("#J_req_error_tpl").html().replace(/{\$className}/,"J_asset_error").replace(/{\$desc}/,"\u67e5\u770b\u6211\u7684\u4f18\u60e0\u5238").replace(/{\$link}/,link);nsSideBar.util.done();bd.empty();bd.append(html)},mars:function(){}}};module.exports=nsAssetMod},{}],2:[function(require,module,exports){var nsBrandV2={init:function(){$("#J_brand").on("click.toMyBrand",function(){window.open("http://fav.vip.com/index.php?r=/fav/brand")});$.Listeners.sub("sidebar.init").onsuccess(function(){$.Loader.pagelet({name:"sidebarFavData",
css:["http://ugc.vipstatic.com/css/public/fav/1/sidebar.css?"+VIPSHOP.cssVer],js:["http://ugc.vipstatic.com/js/public/fav/1/sidebar.js?"+VIPSHOP.jsVer]})});this.subEvent()},subEvent:function(){$.Listeners.sub("sidebar.ready.fav").onsuccess(function(){nsBrandV2.brand.init();$("#J_brand").off("click.toMyBrand")})},brand:{init:function(){this.subEvent()},subEvent:function(){var _this=this;$.Listeners.sub("brandPop").onsuccess(function(){$.Listeners.pub("sidebar.hide.redPoint").success({mod:"brand"});
nsSideBar.bao.close()});$.Listeners.sub("sidebar.clickPop.openBrand").onsuccess(function(){$("#J_brand").trigger("click")})}}};module.exports=nsBrandV2},{}],3:[function(require,module,exports){var nsCartMod={init:function(){var _this=this;_this.cart.init();_this.cartCnt.init()},cart:{isTimeOpen:true,init:function(){nsSideBar.util.sub("barCountdown",this);this.barCountdown();this.subEvent();$("#J_skuCount_container").removeClass("hidden")},subEvent:function(){var _this=this;$.Listeners.sub("cart.reset.success").onsuccess(function(data){$("#J_cart_num").html(data.num);
_this.isTimeOpen=data.open});$.Listeners.sub("header.get.payTip").onsuccess(function(){var jqSbarTipPop=$("#J_sbar_tip_pop");jqSbarTipPop.show()});$.Listeners.sub("sbarWrap").onsuccess(function(data){var jqSbarTipPop=$("#J_sbar_tip_pop");if(jqSbarTipPop.length==0)return;if(data.open)jqSbarTipPop.addClass("sidebarcom-tips-show");else jqSbarTipPop.removeClass("sidebarcom-tips-show")});nsSideBar.util.sub("sidebarCartInit",_this);nsSideBar.util.sub("sidebarHoverCart",_this);nsSideBar.util.sub("sidebarMosleaveCart",
_this)},sidebarCartInit:function(re){var html=$("#J_cart_cnt").html(),$container=re.container;$container.html(html).find(".J_pop_bd").addClass("sidebarcom-loading");this.isCartFreeReg=re.isCartFreeReg},sidebarHoverCart:function(){var _this=this,fn=$.proxy(_this.hoverCD,_this);$.Listeners.sub("cart.init").onsuccess(function(){nsSideBar.cart.disposeCartData(function(cartData){fn(cartData);_this.getCartData(cartData);_this.runTime(cartData)})})},sidebarMosleaveCart:function(){if(!nsCartMod.cart.timeForce)$("#J_sbar_hover_cd").hide()},
barCountdown:function(){var _this=this;$.Listeners.sub("cart.init").onsuccess(function(){nsSideBar.cart.disposeCartData(function(cartData){_this.getCartData(cartData);_this.runTime(cartData)})})},getCartData:function(cartData){if(cartData.result==-1)return;var end_time=cartData.cartInfo.end_time-0;if(!cartData&&cartData.cartList)return false;var target=$("#J_cart_num, .J_cart_count, #J_skuCount");var sku_count=cartData.cartList.sku_count;var leftTime=VIPSHOP.core3===true?VIPSHOP.Time.fn_countDown(end_time):
fn_CountDown(end_time);target.html(sku_count);nsSideBar.cart.reloadHeadCart(cartData)},hoverCD:function(cartData){if(cartData.result==-1){nsSideBar.util.chkLogin("#J_cart",true);return false}var that=this;var jqSbarHoverCd=$("#J_sbar_hover_cd");var jqCartLi=$("#J_cart").parents("li");var endTime=cartData.cartInfo.end_time;var leftTime=VIPSHOP.core3===true?VIPSHOP.Time.fn_countDown(endTime):fn_CountDown(endTime);if(leftTime.min!=0&&leftTime.sec!=0)jqSbarHoverCd.show()},runTime:function(cartData){var that=
this;if(cartData.result==-1)return false;var endTime=cartData.cartInfo.end_time;var leftTime=VIPSHOP.core3===true?VIPSHOP.Time.fn_countDown(endTime):fn_CountDown(endTime);var jqSbarHoverCd=$("#J_sbar_hover_cd");if(endTime==0||leftTime.min==0&&leftTime.sec==0){nsCartMod.cart.timeForce=false;jqSbarHoverCd.hide();return}if(nsCartMod.cart.hoverCdInterval)clearInterval(nsCartMod.cart.hoverCdInterval);nsCartMod.cart.cdFn(endTime,jqSbarHoverCd);nsCartMod.cart.hoverCdInterval=setInterval(function(){nsCartMod.cart.cdFn(endTime,
jqSbarHoverCd)},1E3)},cdFn:function(endTime,target){var leftTime=VIPSHOP.core3===true?VIPSHOP.Time.fn_countDown(endTime):fn_CountDown(endTime);var leftTxt=[];var closeFn=this.hideCD;var cartNums=$.Cookie.get("VipCI_te").split("|")[0]||0;var that=this;if(cartNums==0){clearInterval(this.hoverCdInterval);nsCartMod.cart.timeForce=false;$("#J_cart_num, .J_cart_count").html(0);$.Listeners.pub("cart.empty").success();closeFn();return}if(leftTime.min==0&&leftTime.sec==0){var title=$("#J_cart_title");var timeoutTitle=
$("#J_cart_timeout_cnt").html();title.html(timeoutTitle);closeFn();return}leftTxt.push(leftTime.min);leftTxt.push("\u5206");leftTxt.push(leftTime.sec);leftTxt.push("\u79d2");if(cartNums>0&&leftTime.min<3){if(!that.isTimeOpen){closeFn();return}if(!nsCartMod.cart.timeForce)nsCartMod.cart.timeForce=true;if(nsSideBar.wrapShow===false)target.show();else target.hide();leftTxt.unshift("! ")}this.cartNums=cartNums;target.find("span").html(leftTxt.join(""))},hideCD:function(){var jqSbarHoverCd=$("#J_sbar_hover_cd");
jqSbarHoverCd.hide()}},cartCnt:{el:"#J_sidebar",events:{"click #J_cart_close":"closePop","click .J_cart_tip_close":"closeTip","click .J_sbar_pop_tips_close":"closeUnpayTip"},init:function(){var that=this;nsSideBar.util.bindEvent(this);nsSideBar.util.sub("cartPop",this);$.Listeners.sub("cart.init").onsuccess(function(){nsSideBar.cart.disposeCartData($.proxy(that.countDown,that))})},cartPop:function(){var _this=this;nsSideBar.util.scrollBar();nsSideBar.cart.disposeCartData(function(cartData){nsCartMod.cart.runTime(cartData);
_this.fetchCartData(cartData)});nsCartMod.cart.hideCD()},fetchCartData:function(cartData){var that=this;if(cartData.result==-1)return;var sku_count=0;var endTime=cartData.cartInfo.end_time-0;var leftTime=VIPSHOP.core3===true?VIPSHOP.Time.fn_countDown(endTime):fn_CountDown(endTime);nsSideBar.util.done();if(cartData&&cartData.cartList){sku_count=cartData.cartList.sku_count;$("#J_cart_num, .J_cart_count").html(sku_count);if(sku_count==0){that.emptyCart();$.Listeners.pub("cart.empty").success()}else{that.haveCart(cartData,
leftTime);that.countDown(cartData)}}else that.emptyCart();nsSideBar.cart.reloadHeadCart(cartData)},haveCart:function(cartData,leftTime){var bd=nsSideBar.util.bd();var tpl=$("#J_cart_have_tpl");var title=$("#J_cart_title");var timeoutTitle=$("#J_cart_timeout_cnt").html();if(cartData.result==-1){nsSideBar.util.chkLogin("#J_cart",true);return false}if(leftTime.min==0&&leftTime.sec==0)title.html(timeoutTitle);else{var txt=[leftTime.min,"\u5206",leftTime.sec,"\u79d2"].join(""),countdownTitle='\u8d2d\u7269\u888b<em id="J_cart_title_countdown" class="sidebarcom-pop-hd-tips">'+
txt+"</em> <em>\u540e\u6e05\u7a7a</em>";title.html(countdownTitle)}bd.Template({templateElement:tpl,replace:true}).Template("process",cartData.cartList);this.firstTip();this.cartResize();nsSideBar.util.scrollBar();var userClass=UINFO.parseCookie()["suc"];if(userClass=="c3")$(".J_cart_goods_link").each(function(i,n){var href=$(n).attr("href");$(n).attr("href",href+"&f=0|0|0|1")})},cartResize:function(){var jqWrap=$("#J_wrap");var jqHd=jqWrap.find(".sidebarcom-pop-hd");var bd=nsSideBar.util.bd();var jqSbarCartList=
bd.find(".sidebarcom-cart-list");var jqCartList=bd.find(".m-cart-list");$(window).off("resize.sbarCartFix");$(window).on("resize.sbarCartFix",function(){var wrapHeight=jqWrap.outerHeight(true);var hdHeight=jqHd.outerHeight(true);var listHeight=jqCartList.outerHeight(true);if(listHeight+hdHeight>wrapHeight-40)jqSbarCartList.addClass("cart-oper-fixed");else jqSbarCartList.removeClass("cart-oper-fixed")}).trigger("resize.sbarCartFix")},emptyCart:function(){var bd=nsSideBar.util.bd();var tpl=$("#J_cart_empty_tpl");
var title=$("#J_cart_title");var countdownTitle="\u8d2d\u7269\u888b";title.html(countdownTitle);bd.Template({templateElement:tpl,replace:true}).Template("process",{});nsSideBar.util.scrollBar()},closePop:function(){$.Listeners.pub("closeSidebarPop").success();var countDowner=this.countDowner;countDowner&&clearInterval(countDowner)},closeTip:function(){nsSideBar.util.closeTip(this);$("#J_sbar_hover_cd").find(".cart-pop-arrow").show()},closeUnpayTip:function(){var RUID=$.Cookie.get("VipRUID");$("#J_sbar_tip_pop").hide()},
openTip:function(name){var nameTable={secret:"#J_cart_secret",last3mins:"#J_cart_last3mins",timeout:"#J_cart_timeout"};nsSideBar.util.closeTip();$("#J_cart_all_tip").show();$(nameTable[name]).show()},countDown:function(cartData){if(cartData.result==-1)return;var VipLID=$.Cookie.get("VipLID");var endTime=cartData.cartInfo.end_time;var numDom=$("#J_cart_title_countdown");var last3Mins=$.Storage.get("last3MinsTip");var sku_count=cartData.cartList.sku_count;var timeout=false;var that=this;if(!nsCartMod.cart.isCartFreeReg&&
!VipLID||endTime===false)return;this.countDowner&&clearInterval(this.countDowner);this.countDowner=setInterval(function(){var rt=VIPSHOP.core3===true?VIPSHOP.Time.fn_countDown(endTime):fn_CountDown(endTime);var txt=[rt.min,"\u5206",rt.sec,"\u79d2"].join("");numDom.html(txt);var last_rule1=rt.day==0&&(rt.hour==0&&rt.min<=2);var last_rule2=that.cartNums&&that.cartNums>0;if(!last3Mins&&(last_rule1&&last_rule2)){that.openTip("last3mins");$.Storage.set("last3MinsTip",1,365*24*60*60);last3Mins=1;$("#J_sbar_hover_cd").find(".cart-pop-arrow").hide()}var timeout_rule1=
rt.day==0&&(rt.hour==0&&(rt.min==0&&(rt.sec==1&&!timeout)));if(timeout_rule1)setTimeout(function(){that.openTip("timeout");that.skuCount=sku_count;timeout=true;clearInterval(that.countDowner);$("#J_cart_timeout .pop-font-btn").attr("href","http://cart.vip.com/te2/");$.Listeners.pub("sidebarCartOvertimeToClose").success()},1E3)},1E3);$.Listeners.sub("sidebarCartOvertimeToClose").onsuccess(function(){setTimeout(function(){$("#J_cart_all_tip").hide()},5E3)})},firstTip:function(){var firstAddCart=$.Storage.get("firstAddCart");
if(!firstAddCart){var jqCartFirstAdd=$("#J_cart_first_add");jqCartFirstAdd.show();$.Storage.set("firstAddCart",1);setTimeout(function(){jqCartFirstAdd.hide()},5E3)}}}};module.exports=nsCartMod},{}],4:[function(require,module,exports){var nsGoodsV2={init:function(){$("#J_fav").on("click.toMyFav",function(){window.open("http://fav.vip.com/index.php?r=/fav/goods")});$.Listeners.sub("sidebar.init").onsuccess(function(){$.Loader.pagelet({name:"sidebarFavData",css:["http://ugc.vipstatic.com/css/public/fav/1/sidebar.css?"+
VIPSHOP.cssVer],js:["http://ugc.vipstatic.com/js/public/fav/1/sidebar.js?"+VIPSHOP.jsVer]})});this.subEvent()},subEvent:function(){$.Listeners.sub("sidebar.ready.fav").onsuccess(function(){nsGoodsV2.fav.init();$("#J_fav").off("click.toMyFav")})},fav:{init:function(){this.subEvent()},subEvent:function(){var _this=this,titleFlashT=null,flag=0,title=document.title;$.Listeners.sub("favPop").onsuccess(function(){$.Listeners.pub("sidebar.hide.redPoint").success({mod:"goods"})});$.Listeners.sub("sidebar.hd.waitlistTips").onsuccess(function(data){_this.waitListTopTip(data.num)});
$.Listeners.sub("sidebar.addCartCb.goods").onsuccess(function(){$.Listeners.sub("cart.init").onsuccess(function(){nsSideBar.cart.disposeCartData(function(data){$("#J_cart_num, .J_cart_count, #J_skuCount").html(data.cartList.sku_count);nsSideBar.cart.reloadHeadCart(data)})})});$.Listeners.sub("sidebar.txtShow.browser").onsuccess(function(data){titleFlashT=setInterval(function(){if(!flag){document.title="[\u6709\u8d27\u5566]"+title;flag=1}else{document.title=title;flag=0}},1E3)});$.Listeners.sub("sidebar.txtHide.browser").onsuccess(function(){if(titleFlashT)titleFlashT=
clearInterval(titleFlashT);document.title=document.title.replace("[\u6709\u8d27\u5566]","")});$.Listeners.sub("sidebar.clickPop.openGoods").onsuccess(function(){$("#J_fav").trigger("click")})},waitListTopTip:function(num){if(num&&num>0)if($("#J_wait_list_tips").length==0&&nsSideBar.wrapShow!="favPop"){var tipHtml=$("#J_waitlist_top_tips_tpl").html();if(nsSideBar.wrapShow!="favPop")$(".J_pop_bd").prepend(tipHtml);else $("#J_sbar_wait_have").prepend(tipHtml);var jqWaitListTips=$("#J_wait_list_tips"),
jqWaitListNum=$("#J_wait_list_num");jqWaitListTips.show();jqWaitListNum.html(num);setTimeout(function(){jqWaitListTips.hide()},3E3)}}}};module.exports=nsGoodsV2},{}],5:[function(require,module,exports){var nsPersonalInfoMod={init:function(){var _this=this;_this.my.init();_this.myCnt.init()},my:{ajaxUrl:{info:"http://user.myopen.vip.com/user/userinfo"},ajaxData:{info:{fileds:"avatar",_callback:"userInfo",_cache:false,_localCache:true,_localCacheTime:30*60}},ajaxCb:{info:"infoCb"},init:function(){var VipRUID=
$.Cookie.get("VipRUID");var data=this.ajaxData.info;var k="info";var dataStr=nsSideBar.util.ajaxDataToStr(data);var key=[VipRUID,dataStr,k].join("_");if(!nsSideBar.util.chkLogin()){if($.Storage.get(key))nsSideBar.util.ajax(this)}else nsSideBar.util.ajax(this);this.subEvent()},subEvent:function(){var _this=this;nsSideBar.util.sub("sidebarMyInit",_this)},sidebarMyInit:function(re){var html=$("#J_my_cnt").html(),$container=re.container;$container.html(html).find("#J_sbar_logon_inf").show()},infoCb:function(data){var avatar=
data.data.avatar;var html=$("#J_my_logo").html();var name=$.Cookie.get("VipRNAME");var jqMy=$("#J_my");$.Listeners.pub("myInfo").success(data);if(data.code==1)return false;if(avatar)if(!this.logo){jqMy.append(html.replace(/{\$my_logo}/,avatar));jqMy.find(".i-sidebarcom-my").hide();this.logo=true}$("#J_my_cnt_link").attr("title",name)},apiSwitchs:{info:1}},myCnt:{el:"#J_login_wrap",events:{"click #J_to_reg":"toReg","click #J_to_login":"toLogin","mouseleave":"mosLeave","click #J_my_close":"closeMyCnt"},
ajaxUrl:{msg:"http://user.myopen.vip.com/message/numunread",unpay:"http://checkout.vip.com/app/getUnpayOrder.php",unpayPrepayOrder:"http://order.vip.com/presell/duetopaylist"},ajaxData:{msg:{_callback:"userMsg",_cache:false,_localCache:true,_localCacheTime:3*60},unpay:{_callback:"unpay",_cache:true,_localCache:true,_localCacheTime:60},unpayPrepayOrder:{_callback:"unpayPrepayOrderAmountsCb",_cache:true,_localCache:true,_localCacheTime:60*10}},data:{unpayNormalOrderAmount:0,unpayPrepayOrderAmount:0,
allUnpayOrderAmount:0},ajaxCb:{msg:"msgCb",unpay:"unpayCb",unpayPrepayOrder:"unpayPrepayOrderAmountsCb"},apiSwitchs:{msg:1,unpay:1,unpayPrepayOrder:window.openOrderPrePayApi},init:function(){var that=this;nsSideBar.util.bindEvent(this);nsSideBar.util.sub("myPop",that)},toReg:function(){nsSideBar.util.jumpTo("reg")},toLogin:function(){nsSideBar.util.jumpTo("login")},myPop:function(){nsSideBar.util.ajax(this);this.Monopoly();this.showName();this.mars()},msgCb:function(data){var jqMyMsgNum=$("#J_my_msg_num");
var jqMyMsgLink=$("#J_my_msg_link");var MsgNum=$.Storage.get("msg_num");if(data.code==1){nsSideBar.util.chkLogin("#J_my",true);nsSideBar.util.ajaxRmCache(this);return false}if(MsgNum!=data.data.count)jqMyMsgNum.html(data.data.count).show();jqMyMsgLink.on("click",function(){var t=31536E3;jqMyMsgNum.hide();$.Storage.set("msg_num",data.data.count,t)})},unpayCb:function(data){var jqMyOrderLink=$("#J_my_order_link");var jqUnpayNum=$("#J_unpay_num");var unpayNum=$.Storage.get("unpay_num");var that=this;
that.data.unpayNormalOrderAmount=data.total?data.total:0;if(unpayNum!=data.total&&data.total>0){that.data.allUnpayOrderAmount=that.data.unpayPrepayOrderAmount+that.data.unpayNormalOrderAmount;jqUnpayNum.html(that.data.allUnpayOrderAmount).show()}jqMyOrderLink.on("click",function(){var t=31536E3;jqUnpayNum.hide();$.Storage.set("unpay_num",data.total,t);nsSideBar.util.ajaxRmCache(that,"unpay")})},Monopoly:function(){var lvCookie=$.Cookie.get("VipMonopoly");var cklevel=parseInt(lvCookie);var jqSbarVipclub=
$("#J_sbar_vipclub");var jqViplevelName=$(".J_viplevel_name");var jqViplevel=$(".J_viplevel");var jqSbarPrivilege=$("#J_sbar_privilege");if(cklevel||cklevel===0){var lvClass="uv_"+(cklevel+1);var lvIconsClass="ions-style"+(cklevel+1);var levels=["\u94c1\u724c","\u94dc\u724c","\u94f6\u724c","\u91d1\u724c","\u94bb\u77f3","\u7687\u51a0"];jqViplevelName.attr("title",levels[cklevel]);jqViplevel.addClass(lvClass);jqSbarPrivilege.show().addClass(lvIconsClass);jqSbarVipclub.hide()}else jqSbarVipclub.show()},
showName:function(){var userName=$.Cookie.get("VipRNAME");var _userName=nsSideBar.util.procName(userName);var helloTxt="\u4f60\u597d";$("#J_user_name").html(_userName).attr("title",userName);$.Listeners.sub("myInfo").ononce(function(data){var avatar=data.data.avatar;if(avatar)$("#J_my_pic").attr("src",avatar)});$("#J_my_hello").html(helloTxt)},mosLeave:function(e){var jqTarget=$(e.relatedTarget);var jqTargetPa=jqTarget.parents("#J_my")[0];if(jqTargetPa!=$("#J_my")[0]){$("#J_my").removeClass("selected");
nsSideBar.util.hideLoginCnt()}},closeMyCnt:function(){$.Listeners.pub("closeSidebarSmallPop").success()},mars:function(){var marsList={"#J_my_order_link":"rightnav_my_order","#J_my_msg_link":"rightnav_my_news"};nsSideBar.util.mars(marsList)},unpayPrepayOrderAmountsCb:function(data){var that=this;var jqMyOrderLink=$("#J_my_order_link");var jqUnpayNum=$("#J_unpay_num");that.data.unpayPrepayOrderAmount=data.result?data.result.length:0;var preAmounts=0;$.crossStorage.get("unpay_prepay_order_num",function(unpay_prepay_order_num){preAmounts=
unpay_prepay_order_num?unpay_prepay_order_num:0;if(preAmounts!=that.data.unpayPrepayOrderAmount&&that.data.unpayPrepayOrderAmount>0){that.data.allUnpayOrderAmount=that.data.unpayPrepayOrderAmount+that.data.unpayNormalOrderAmount;jqUnpayNum.html(that.data.allUnpayOrderAmount).show()}});jqMyOrderLink.on("click",function(){var t=60*10;jqUnpayNum.hide();$.crossStorage.set("unpay_prepay_order_num",that.data.unpayPrepayOrderAmount,t);nsSideBar.util.ajaxRmCache(that,"unpayPrepayOrder")})}}};module.exports=
nsPersonalInfoMod},{}],6:[function(require,module,exports){var nsSidebarBoPlugin=function(ele,opt){this.$element=ele;this.defaultOpt={isClick:1,ep:"li",curPopName:"",openType:1,clickPubName:"",hoverPubName:"",mosLeavePubName:"",mouseShowMod:0,showType:0,container:null,isCartFreeReg:false,mars:{},setStyle:{"padding":"0 14px","width":"246px"}};this.options=$.extend({},this.defaultOpt,opt||{});this.init()};nsSidebarBoPlugin.prototype={init:function(){var _this=this;_this.subEvent();_this.bindEvent()},
subEvent:function(){var _this=this;$.Listeners.sub("cart.askInfo.success").onsuccess(function(){_this.freeRegClose=false});$.Listeners.sub("cart.ask.login").onsuccess(function(){_this.freeRegClose=true})},bindEvent:function(){var _this=this;_this.$element.on("click",function(){if(!_this.options.isClick)return;_this.showCnt()}).on("mouseenter",function(){_this.mosEnter()}).on("mouseleave",function(){_this.mosLeave()})},showCnt:function(){var _this=this;if(_this.isDoShow()){var isShowCnt=_this.isShowCnt(_this.options.showType);
nsSideBar.util.select(_this.$element);if(_this.options.mars)_this.mars(_this.options.mars);if(!isShowCnt)return;_this.openCnt(_this.options.container,_this.options.openType,_this.options.clickPubName);nsSideBar.wrapShow=_this.options.curPopName;nsSideBar.util.pub(_this.options.curPopName)}},isDoShow:function(){var _this=this;if(nsSideBar.wrapShow==_this.options.curPopName){switch(_this.options.mouseShowMod){case 1:nsSideBar.util.hideLoginCnt();$(this).removeClass("selected");break;default:nsSideBar.util.hideAllCnt();
break}return false}else return true},mosEnter:function(e){var _this=this;switch(_this.options.mouseShowMod){case 0:this.$element.parents(this.options.ep).addClass("curr");$.Listeners.pub(_this.options.hoverPubName).success();break;case 1:if(nsSideBar.wrapShow==false)_this.showCnt.apply(_this,[e,"mosEnter"]);break;default:break}},mosLeave:function(){var _this=this;switch(_this.options.mouseShowMod){case 0:this.$element.parents(this.options.ep).removeClass("curr","selected");$.Listeners.pub(_this.options.mosLeavePubName).success();
break;case 1:var jqThis=this.$element;jqThis.parents("li").removeClass("curr");setTimeout(function(){$(document).one("mousemove",function(e){var jqLoginWrap=$("#J_login_wrap"),jqTarget=$(e.target),jqTargetPa=jqTarget.parents("#J_login_wrap");if(jqTarget[0]!=jqLoginWrap[0]&&jqTargetPa[0]!=jqLoginWrap[0]){jqThis.removeClass("selected");nsSideBar.util.hideLoginCnt()}})},50);break;default:break}},openCnt:function($container,type,pubName){var _this=this;switch(type){case 1:$container.css({"padding":_this.options.setStyle.padding,
"width":_this.options.setStyle.width}).addClass("sidebarcom-pop-show");$.Listeners.pub("sbarWrap").success({open:true,mod:_this.options.curPopName});break;case 2:var offset=this.$element.offset(),scrollTop=$(window).scrollTop();$container.css({top:offset.top-scrollTop}).addClass("sidebarcom-logon sidebarcom-pop-show");break;default:break}$.Listeners.pub(pubName).success({"container":$container,"isCartFreeReg":_this.options.isCartFreeReg})},freeReg:function(){var parseVipUINFO=UINFO.parseCookie(),
isFreeReg=parseVipUINFO.luc==="a"&&parseVipUINFO.p2==1;if(isFreeReg&&(!$.Cookie.get("VipRUID")&&$.Cookie.get("VIPGuest_ID")!=="0"))return true;return false},isShowCnt:function(objName){var _this=this,parseVipUINFO=UINFO.parseCookie(),isShow=false,isFreeReg=_this.freeReg();switch(objName){case 1:if(isFreeReg&&!_this.freeRegClose){_this.options.isCartFreeReg=true;nsSideBar.util.hideLoginCnt();isShow=true}else{var isLogin=nsSideBar.util.chkLogin(_this.$element);if(isLogin)isShow=true}return isShow;break;
default:var isLogin=nsSideBar.util.chkLogin(_this.$element);if(isLogin)isShow=true;return isShow;break}},mars:function(mars){var marsList={};if(!VIPSHOP.member.info)for(var k in mars)marsList[k]=mars[k];nsSideBar.util.mars(marsList)}};module.exports=nsSidebarBoPlugin},{}],7:[function(require,module,exports){var nsSidebarNewCart={init:function(){$("#J_cart_num").hide();nsSidebarNewCart.initData.init();$("#J_cart").on("click.toMyCart",function(){window.open("http://cart.vip.com/te2/")})},initData:{init:function(){var _this=
this;$.Listeners.sub("sidebar.init").onsuccess(function(){$.Loader.pagelet({name:"newSideBarCart",css:["http://ccp.vipstatic.com/css/public/cart/te/4/mini-bar/index.css?"+VIPSHOP.cssVer],js:["http://ccp.vipstatic.com/js/public/cart/te/4/sidebar.js?"+VIPSHOP.jsVer]})});$.Listeners.sub("cart.askInfo.init.success").onsuccess(function(re){nsSidebarNewCart.cart.getCartData(re)});$.Listeners.sub("cart.ask.login").onsuccess(function(re){$("#J_sidebar").delegate("#J_cart","click",function(){nsSideBar.util.chkLogin("#J_cart",
true)})});nsSideBar.util.sub("closeSidebarNewCartPop",_this);nsSideBar.util.sub("sidebarCartReady",_this);nsSideBar.util.sub("aodSidebarCart",_this);$.Listeners.sub("cart.reset.success").onsuccess(function(data){$("#J_cart_num").html(data.num);nsSidebarNewCart.cart.isTimeOpen=data.open})},closeSidebarNewCartPop:function(){nsSideBar.util.hideAllCnt()},sidebarCartReady:function(){nsSidebarNewCart.cart.init();nsSidebarNewCart.cartCnt.init();$("#J_cart").off("click.toMyCart");$("#J_skuCount_container").removeClass("hidden");
$("#J_cart_num").show()},aodSidebarCart:function(){nsSidebarNewCart.cart.barCountdown()}},cart:{isTimeOpen:true,init:function(){nsSideBar.util.sub("barCountdown",this);this.barCountdown();this.subEvent()},subEvent:function(){var _this=this;nsSideBar.util.sub("sidebarCartInit",_this);nsSideBar.util.sub("sidebarHoverCart",_this);nsSideBar.util.sub("sidebarMosleaveCart",_this);$.Listeners.sub("header.get.payTip").onsuccess(function(){var jqSbarTipPop=$("#J_sbar_tip_pop");jqSbarTipPop.show()});$.Listeners.sub("sbarWrap").onsuccess(function(data){var jqSbarTipPop=
$("#J_sbar_tip_pop");if(jqSbarTipPop.length==0)return;if(data.open)jqSbarTipPop.addClass("sidebarcom-tips-show");else jqSbarTipPop.removeClass("sidebarcom-tips-show")})},sidebarCartInit:function(re){var _this=this;this.isCartFreeReg=re.isCartFreeReg},sidebarHoverCart:function(){var _this=this,fn=$.proxy(_this.hoverCD,_this);$.Listeners.sub("cart.init").onsuccess(function(){nsSideBar.cart.disposeCartData(function(cartData){fn(cartData);_this.getCartData(cartData);_this.runTime(cartData)})})},sidebarMosleaveCart:function(){if(!nsSidebarNewCart.cart.timeForce)$("#J_sbar_hover_cd").hide()},
barCountdown:function(){var _this=this;$.Listeners.sub("cart.init").onsuccess(function(){nsSideBar.cart.disposeCartData(function(cartData){_this.getCartData(cartData);_this.runTime(cartData)})})},getCartData:function(cartData){if(cartData.result==-1)return;var end_time=cartData.cartInfo.end_time-0;if(!cartData&&cartData.cartList)return false;var target=$("#J_cart_num, .J_cart_count, #J_skuCount");var sku_count=cartData.cartList.sku_count;if(!end_time)var leftTime=VIPSHOP.core3===true?VIPSHOP.Time.fn_countDown(end_time):
fn_CountDown(end_time);target.html(sku_count)},hoverCD:function(cartData){if(cartData.result==-1){nsSideBar.util.chkLogin("#J_cart",true);return false}var that=this;var jqSbarHoverCd=$("#J_sbar_hover_cd");var jqCartLi=$("#J_cart").parents("li");var endTime=cartData.cartInfo.end_time;var leftTime=VIPSHOP.core3===true?VIPSHOP.Time.fn_countDown(endTime):fn_CountDown(endTime);if(leftTime.min!=0&&leftTime.sec!=0)jqSbarHoverCd.show()},runTime:function(cartData){var that=this;if(cartData.result==-1)return false;
var endTime=cartData.cartInfo.end_time;var leftTime=VIPSHOP.core3===true?VIPSHOP.Time.fn_countDown(endTime):fn_CountDown(endTime);var jqSbarHoverCd=$("#J_sbar_hover_cd");if(endTime==0||leftTime.min==0&&leftTime.sec==0){nsSidebarNewCart.cart.timeForce=false;jqSbarHoverCd.hide();return}if(that.hoverCdInterval)clearInterval(nsSidebarNewCart.cart.hoverCdInterval);nsSidebarNewCart.cart.cdFn(endTime,jqSbarHoverCd);nsSidebarNewCart.cart.hoverCdInterval=setInterval(function(){nsSidebarNewCart.cart.cdFn(endTime,
jqSbarHoverCd)},1E3)},cdFn:function(endTime,target){var leftTime=VIPSHOP.core3===true?VIPSHOP.Time.fn_countDown(endTime):fn_CountDown(endTime);var leftTxt=[];var closeFn=this.hideCD;var cartNums=$.Cookie.get("VipCI_te").split("|")[0]||0;var that=this;if(cartNums==0||leftTime.min==0&&leftTime.sec==0){clearInterval(this.hoverCdInterval);nsSidebarNewCart.cart.timeForce=false;$.Listeners.pub("cart.empty").success();closeFn();target.find("span").html("");return}leftTxt.push(leftTime.min);leftTxt.push("\u5206");
leftTxt.push(leftTime.sec);leftTxt.push("\u79d2");if(cartNums>0&&leftTime.min<3){if(!that.isTimeOpen){closeFn();return}if(!nsSidebarNewCart.cart.timeForce)nsSidebarNewCart.cart.timeForce=true;if(nsSideBar.wrapShow===false)target.show();else target.hide();leftTxt.unshift("! ")}this.cartNums=cartNums;target.find("span").html(leftTxt.join(""))},hideCD:function(){var jqSbarHoverCd=$("#J_sbar_hover_cd");jqSbarHoverCd.hide()}},cartCnt:{el:"#J_sidebar",events:{"click .J_cart_tip_close":"closeTip","click .J_sbar_pop_tips_close":"closeUnpayTip"},
init:function(){var that=this;nsSideBar.util.bindEvent(this);nsSideBar.util.sub("cartPop",this);$.Listeners.sub("cart.init").onsuccess(function(){nsSideBar.cart.disposeCartData($.proxy(that.countDown,that))})},cartPop:function(){var _this=this;nsSideBar.cart.disposeCartData(function(cartData){_this.fetchCartData(cartData);nsSidebarNewCart.cart.runTime(cartData)});nsSidebarNewCart.cart.hideCD()},fetchCartData:function(cartData){var that=this;if(cartData.result==-1)return;var sku_count=0;var endTime=
cartData.cartInfo.end_time-0;var leftTime=VIPSHOP.core3===true?VIPSHOP.Time.fn_countDown(endTime):fn_CountDown(endTime);if(leftTime.min==0&&(leftTime.sec==0&&that.timeOut))that.timeOut=false;if(cartData&&cartData.cartList){sku_count=cartData.cartList.sku_count;$("#J_cart_num, .J_cart_count, #J_skuCount").html(sku_count);if(sku_count!=0)that.countDown(cartData);else $.Listeners.pub("cart.empty").success()}},closeTip:function(){nsSideBar.util.closeTip(this);$("#J_sbar_hover_cd").find(".cart-pop-arrow").show()},
closeUnpayTip:function(){var RUID=$.Cookie.get("VipRUID");$("#J_sbar_tip_pop").hide()},openTip:function(name){var nameTable={secret:"#J_cart_secret",last3mins:"#J_cart_last3mins",timeout:"#J_cart_timeout"};nsSideBar.util.closeTip();$("#J_cart_all_tip").show();$(nameTable[name]).show()},countDown:function(cartData){if(cartData.result==-1)return;var VipLID=$.Cookie.get("VipLID");var endTime=cartData.cartInfo.end_time;var numDom=$("#J_cart_title_countdown");var txtDom=$("#J_cart_title_countdown_txt");
var last3Mins=$.Storage.get("last3MinsTip");var sku_count=cartData.cartList.sku_count;var timeout=false;var that=this;if(!nsSidebarNewCart.cart.isCartFreeReg&&!VipLID||endTime===false)return;this.countDowner&&clearInterval(this.countDowner);this.countDowner=setInterval(function(){var rt=VIPSHOP.core3===true?VIPSHOP.Time.fn_countDown(endTime):fn_CountDown(endTime);var txt=[rt.min,"\u5206",rt.sec,"\u79d2"].join("");numDom.html(txt).show();txtDom.show();var last_rule1=rt.day==0&&(rt.hour==0&&rt.min<=
2);var last_rule2=that.cartNums&&that.cartNums>0;if(!last3Mins&&(last_rule1&&last_rule2)){that.openTip("last3mins");$.Storage.set("last3MinsTip",1,365*24*60*60);last3Mins=1;$("#J_sbar_hover_cd").find(".cart-pop-arrow").hide()}var timeout_rule1=rt.day==0&&(rt.hour==0&&(rt.min==0&&(rt.sec==1&&!timeout)));if(timeout_rule1)setTimeout(function(){that.openTip("timeout");that.timeOut=true;that.skuCount=sku_count;timeout=true;clearInterval(that.countDowner);$("#J_cart_timeout .pop-font-btn").attr("href",
"http://cart.vip.com/te2/");$.Listeners.pub("sidebarCartOvertimeToClose").success()},1E3)},1E3);$.Listeners.sub("sidebarCartOvertimeToClose").onsuccess(function(){setTimeout(function(){$("#J_cart_all_tip").hide()},5E3)})}}};module.exports=nsSidebarNewCart},{}],8:[function(require,module,exports){var sidebarConfig={init:function(){this.cartSet()},onAndOff:{on:"on",off:"off"},registerMods:{my:rightBarConf.rightBarMyApi,asset:rightBarConf.rightBarAssetApi,brand:rightBarConf.rightBarFavBrandApi,goods:rightBarConf.rightBarFavGoodsApi,
waitlist:rightBarConf.waitlistOpen,cart:rightBarConf.rightBarCartApi,newCart:rightBarConf.rightBarCartApi},rcabtCookie:parseInt(UINFO.parseCookie()["rcabt"])||0,isNewCart:function(){var isAbtestOrOld=VIPSHOP.isRcabtFromABTEST?VIPSHOP.isRcabtFromABTEST:0;return isAbtestOrOld?this.rcabtCookie:0},cartSet:function(){$("#J_skuCount_container").hide;if(!rightBarConf.rightBarCartApi){sidebarConfig.registerMods["newCart"]=0;sidebarConfig.registerMods["cart"]=0;$.Listeners.pub("openCartClose").success();$("#J_cart_num").hide();
$("#J_cart").on("click.toMyCart",function(){window.open("http://cart.vip.com/te2/")});return}var isNewCart=this.isNewCart();switch(isNewCart){case 1:sidebarConfig.registerMods["newCart"]=1;sidebarConfig.registerMods["cart"]=0;break;case 0:sidebarConfig.registerMods["newCart"]=0;sidebarConfig.registerMods["cart"]=1;break}},registerEvent:function(paramObj,callback){var onMod=sidebarConfig.registerMods[paramObj]?sidebarConfig.onAndOff.on:sidebarConfig.onAndOff.off;switch(onMod){case "on":$.Listeners.pub(sidebarConfig.registerMods[paramObj]).success();
callback&&callback();break;default:break}}};module.exports=sidebarConfig},{}],9:[function(require,module,exports){var nsSidebarBoPlugin=require("./modules/sidebar/nsSidebarBoPlugin.js");var sidebarConfig=require("./modules/sidebar/sidebarConfig.js");var nsPersonalInfoMod=require("./modules/sidebar/nsPersonalInfoMod.js");var nsAssetMod=require("./modules/sidebar/nsAssetMod.js");var nsBrandV2=require("./modules/sidebar/nsBrandV2.js");var nsGoodsV2=require("./modules/sidebar/nsGoodsV2.js");var nsCartMod=
require("./modules/sidebar/nsCartMod.js");var nsSidebarNewCart=require("./modules/sidebar/nsSidebarNewCart.js");var isIE6=VIPSHOP.core3?VIPSHOP.Detect.isIE6:VIPSHOP.isIE6;window.nsGoodsV2=nsGoodsV2;window.nsBrandV2=nsBrandV2;window.nsCartMod=nsCartMod;window.nsSidebarBoPlugin=nsSidebarBoPlugin;var nsSideBar={util:{bindEvent:function(ns){var elem=$(ns.el);var events=ns.events;for(var type in events){var paris=type.split(/\s/);var evt=ns[events[type]];var args=paris.concat(ns).concat(evt);elem.on.apply(elem,
args)}},hideAllCnt:function(){nsSideBar.el.find(".selected").removeClass("selected").end().find("#J_wrap").removeClass("sidebarcom-pop-show").end().find("#J_all_tip").hide();$.Listeners.pub("sbarWrap").success({open:false});nsSideBar.wrapShow=false;if(window.nsOrder)nsOrder.hold=false;$("#J_wrap").off("mouseenter.submit")},hideLoginCnt:function(){nsSideBar.el.find("#J_login_wrap").removeClass("sidebarcom-pop-show").data("hasPop","");nsSideBar.wrapShow=false},closeTip:function(dom){if(dom)$(dom).parents(".J_all_tip").hide().find(".J_tip_cnt").hide();
else $(".J_all_tip").hide().find(".J_tip_cnt").hide()},jumpTo:function(target){var href=window.location.href;var encodeHref=encodeURIComponent(href);var userHost=VIPSHOP.userHost;var targets={reg:[userHost,"/register?ff=99999|3|1|3&src=",encodeHref],login:[userHost,"/login?ff=99999|3|1|2&src=",encodeHref]};location.href=targets[target].join("")},ajax:function(ns,name,param){var that=this;var o={};var ajaxList=ns.ajaxUrl;var VipRUID=$.Cookie.get("VipRUID");o[name]=1;ajaxList=name?o:ajaxList;for(var k in ajaxList)(function(k){var url=
ns.ajaxUrl[k];var data=ns.ajaxData[k];var dataStr=that.ajaxDataToStr(data);var cache=data._cache;var timeout=data._timeout||8E3;var key=[VipRUID,dataStr,k].join("_");var cb=ns.ajaxCb[k].split(",");var successCb=ns[cb[0]];var errorCb=ns[cb[1]];var isLC=data._localCache;var LCTime=data._localCacheTime;var LCData=$.Storage.get(key);var ableToRequest=ns.apiSwitchs[k];if(VipRUID&&(isLC&&LCData))successCb.apply(ns,[LCData,param]);else if(parseInt(ableToRequest))$.ajax({url:url,data:data,cache:cache,dataType:"jsonp",
timeout:timeout,jsonpCallback:data._callback,success:function(data){if(VipRUID&&isLC)$.Storage.set(key,data,LCTime);if(successCb)successCb.apply(ns,[data,param])},error:function(data){if(errorCb)errorCb.apply(ns,[data,param])}})})(k)},ajaxDataToStr:function(data){var arr=[];for(var i in data)if(i.charAt(0)!="_")arr.push(data[i]);return arr.join("")},ajaxRmCache:function(ns,name){var that=this;var o={};var ajaxList=ns.ajaxUrl;var VipRUID=$.Cookie.get("VipRUID");o[name]=1;ajaxList=name?o:ajaxList;for(var k in ajaxList)(function(k){var data=
ns.ajaxData[k];var dataStr=that.ajaxDataToStr(data);var key=[VipRUID,dataStr,k].join("_");$.Storage.remove(key)})(k)},pub:function(name){$.Listeners.pub(name).success()},sub:function(name,ns){$.Listeners.sub(name).onsuccess($.proxy(ns[name],ns))},bd:function(){return $("#J_wrap").find(".J_pop_bd")},done:function(){var bd=this.bd();bd.removeClass("sidebarcom-loading")},timeToStr:function(time){var rTime=/^\d{4}-\d{2}-\d{2}$/;if(!time)return"";if(rTime.test(time))return time;var timeFix=[time,"000"].join("")-
0;var T=new Date(timeFix);var Y=T.getFullYear();var M=T.getMonth()+1;var D=T.getDate();M=M<10?[0,M].join(""):M;D=D<10?[0,D].join(""):D;return[Y,M,D].join("-")},timeToDesc:function(time){var txtArr=[];var time=[time,"000"].join("")-0;var T=new Date(time);var M=T.getMonth()+1;var D=T.getDate();var H=T.getHours();var timeFix;if(7<H&&H<12)timeFix="\u65e9";else{timeFix="\u665a";H=H-12}txtArr.push(M);txtArr.push("\u6708");txtArr.push(D);txtArr.push("\u65e5");txtArr.push(timeFix);txtArr.push(H);txtArr.push("\u70b9");
txtArr.push(" \u5f00\u552e");return txtArr.join("")},scrollBar:function(){var popBd=$("#J_wrap .J_pop_bd");var popHd=$("#J_wrap .sidebarcom-pop-hd");var jqWin=$(window);var hdH=popHd.outerHeight(true);popBd.perfectScrollbar("destroy");popBd.perfectScrollbar({wheelSpeed:40});jqWin.off("resize.sidebar");jqWin.on("resize.sidebar",function(){var winH=jqWin.height();popBd.height(winH-hdH);popBd.scrollTop(0);popBd.perfectScrollbar("update")}).trigger("resize.sidebar")},chkLogin:function(target,noLogin){nsSideBar.util.winResize();
if(noLogin)return nsSideBar.util.unLogin(target,noLogin);if($.Cookie.get("VipLID")){if(nsSideBar.unlogin)nsSideBar.util.hideLoginCnt();nsSideBar.unlogin=false;return true}else return nsSideBar.util.unLogin(target)},unLogin:function(target){nsSideBar.util.hideAllCnt();if(!target)return false;var html=$("#J_my_cnt").html();var jqWrap=$("#J_login_wrap");var offset=$(target).offset();var scrollTop=$(window).scrollTop();var VipRNAME=$.Cookie.get("VipRNAME");jqWrap.css({top:offset.top-scrollTop});if(!jqWrap.data("hasPop")){jqWrap.html(html).addClass("sidebarcom-pop-show").data("hasPop",
1);nsSideBar.unlogin=true}var jqMyShortcut=$("#J_sbar_my_shortcut");var jqVipclub=$("#J_sbar_vipclub");if($(target).closest("#J_my").length){jqMyShortcut.show();jqVipclub.css("visibility","visible")}else{jqMyShortcut.hide();jqVipclub.css("visibility","hidden")}jqWrap.on("mouseleave",function(){jqWrap.removeClass("sidebarcom-pop-show").data("hasPop","");$("#J_sidebar .selected").removeClass("selected")});if(VipRNAME){VipRNAME=nsSideBar.util.procName(VipRNAME);$("#J_my_cnt_no_name").hide();$("#J_my_cnt_have_name").show();
$("#J_my_cnt_user_name").html(VipRNAME).attr("title",VipRNAME);$.Listeners.sub("myInfo").ononce(function(data){var avatar=data.data.avatar;if(avatar)$("#J_my_pic").attr("src",avatar)})}if(VIPSHOP.member.info)delete VIPSHOP.member.info.account;$.Cookie.del("VipLID",".vip.com","/");return false},winResize:function(){var jqWindow=$(window);var jqWrap=$("#J_login_wrap");jqWindow.off("resize.sbarLogin");jqWindow.on("resize.sbarLogin",function(){var jqSelect=$("#J_sidebar .selected");if(jqSelect.length){var offset=
jqSelect.offset();var scrollTop=jqWindow.scrollTop();jqWrap.css({"top":offset.top-scrollTop})}})},procName:function(name){var fixPoint=name.length>8?"...":"";name=name.substring(0,8);name=[name,fixPoint].join("");return name},select:function(target){nsSideBar.util.hideAllCnt();nsSideBar.util.closeTip();$(target).addClass("selected")},mars:function(marsList){for(var dom in marsList){var marsVal=marsList[dom];$(dom).attr("mars_sead",marsVal)}}},el:"#J_sidebar",events:{"mouseenter":"mosEnter","mouseleave":"mosLeave"},
wrapShow:false,init:function(){this.el=$(this.el);sidebarConfig.init();sidebarConfig.registerEvent("my",nsSideBar.initModCb.myCb);sidebarConfig.registerEvent("asset",nsSideBar.initModCb.assetCb);sidebarConfig.registerEvent("brand",nsSideBar.initModCb.brandCb);sidebarConfig.registerEvent("goods",nsSideBar.initModCb.goodsCb);sidebarConfig.registerEvent("cart",nsSideBar.initModCb.cartCb);sidebarConfig.registerEvent("newCart",nsSideBar.initModCb.newCartCb);new nsSidebarBoPlugin($("#J_sbar_top"),{isClick:0,
ep:".sidebarcom-top"});new nsSidebarBoPlugin($("#J_sbar_survey"),{isClick:0,ep:".sidebarcom-survey"});this.prepayTip.init();this.bind();this.tipManager();nsSideBar.util.bindEvent(this);this.subEvent()},initModCb:{myCb:function(){new nsSidebarBoPlugin($("#J_my"),{curPopName:"myPop",clickPubName:"sidebarMyInit",openType:2,mouseShowMod:1,container:$("#J_login_wrap")});nsPersonalInfoMod.init()},assetCb:function(){new nsSidebarBoPlugin($("#J_asset"),{curPopName:"assetPop",clickPubName:"sidebarAssetInit",
container:$("#J_wrap"),mars:{"#J_to_login":"rightnav_coupon_log","#J_to_reg":"rightnav_coupon_reg"}});nsAssetMod.init()},brandCb:function(){$.Listeners.sub("sidebar.ready.fav").onsuccess(function(){new nsSidebarBoPlugin($("#J_brand"),{curPopName:"brandPop",clickPubName:"sidebarBrandInit",container:$("#J_wrap"),mars:{"#J_to_login":"rightnav_coupon_log","#J_to_reg":"rightnav_coupon_reg"}})});nsBrandV2.init()},goodsCb:function(){$.Listeners.sub("sidebar.ready.fav").onsuccess(function(){new nsSidebarBoPlugin($("#J_fav"),
{curPopName:"favPop",clickPubName:"sidebarFavInit",container:$("#J_wrap"),mars:{"#J_to_login":"rightnav_product_login_log","#J_to_reg":"rightnav_product_login_reg"}})});nsGoodsV2.init();sidebarConfig.registerEvent("waitlist",function(){$.Listeners.pub("sidebar.isOpen.waitlist").success({waitlistInterval:rightBarConf.waitlistInterval})})},cartCb:function(){new nsSidebarBoPlugin($("#J_cart"),{showType:1,curPopName:"cartPop",clickPubName:"sidebarCartInit",container:$("#J_wrap"),hoverPubName:"sidebarHoverCart",
mosLeavePubName:"sidebarMosleaveCart",mars:{"#J_to_login":"rightnav_bag_login_button","#J_to_reg":"rightnav_bag_login_reg"}});nsCartMod.init()},newCartCb:function(){new nsSidebarBoPlugin($("#J_cart"),{showType:1,curPopName:"cartPop",clickPubName:"sidebarCartInit",container:$("#J_wrap"),hoverPubName:"sidebarHoverCart",mosLeavePubName:"sidebarMosleaveCart",mars:{"#J_to_login":"rightnav_bag_login_button","#J_to_reg":"rightnav_bag_login_reg"},setStyle:{"padding":0,"width":285}});nsSidebarNewCart.init()}},
subEvent:function(){$.Listeners.sub("closeSidebarPop").onsuccess(function(){nsSideBar.util.hideAllCnt()});$.Listeners.sub("closeSidebarSmallPop").onsuccess(function(){nsSideBar.util.hideLoginCnt()});$.Listeners.sub("sidebar.addCart.toOpenCart").onsuccess(function(){if(nsSideBar.wrapShow!="cartPop")$("#J_cart").trigger("click");else nsSideBar.util.pub("cartPop")});$.Listeners.sub("sidebar.trigger.toOpenCart").onsuccess(function(){if(nsSideBar.wrapShow=="cartPop")$("#J_cart").trigger("click")});$.Listeners.sub("sidebar.clear.myFavBrandStorage").onsuccess(function(){$.Listeners.pub("sidebar.ask.clearBrandData").success()});
$.Listeners.sub("sidebar.fly.myBrand").onsuccess(function(data){if(nsSideBar.brand&&nsSideBar.brand.addFavBrand){data.flag=data.flag?data.flag:false;nsSideBar.brand.addFavBrand(data.target,data.flag)}});$.Listeners.sub("sidebar.fly.myFav").onsuccess(function(data){if(nsSideBar.fav&&nsSideBar.fav.addFavGoods){data.flag=data.flag?data.flag:false;nsSideBar.fav.addFavGoods(data.target,data.flag)}});$.Listeners.sub("sidebar.fly.baoBeckon").onsuccess(function(data){if(nsSideBar.bao&&nsSideBar.bao.beckon)nsSideBar.bao.beckon(data.target,
data.msg)});$.Listeners.sub("sidebar.display.brandShow").onsuccess(function(data){if(nsSideBar.brand&&nsSideBar.brand.addFavShow){data.flag=data.flag?data.flag:false;nsSideBar.brand.addFavShow(data.flag)}});$.Listeners.sub("sidebar.hide.redPoint").onsuccess(function(data){var mod=data.mod;switch(mod){case "brand":$("#J_sbar_brand_point").hide();break;case "goods":$("#J_fav_point").hide();break;default:}});$.Listeners.sub("sidebar.show.redPoint").onsuccess(function(data){var mod=data.mod;switch(mod){case "brand":$("#J_sbar_brand_point").show();
break;case "goods":$("#J_fav_point").show();break;default:}});$.Listeners.sub("sidebar.show.boPop").onsuccess(function(data){var mod=data.mod,$obj=null,html='<i class="cart-pop-arrow"></i> ';switch(mod){case "brand":$obj=$("#J-sidebarcom-pop-brand");break;case "goods":$obj=$("#J-sidebarcom-pop-goods");break;default:}$obj.html(html+data.domData).addClass("sidebracom-pop-sty").show()});$.Listeners.sub("sidebar.hide.boPop").onsuccess(function(data){var mod=data.mod,$obj=null;switch(mod){case "brand":$obj=
$("#J-sidebarcom-pop-brand");break;case "goods":$obj=$("#J-sidebarcom-pop-goods");break;default:}$obj.hide()});$.Listeners.sub("sidebar.get.notLogin").onsuccess(function(data){var mod=data.mod;switch(mod){case "brand":nsSideBar.util.chkLogin("#J_brand",true);break;case "goods":nsSideBar.util.chkLogin("#J_fav",true);break;default:}})},bind:function(){var that=this;var jqSidebarFt=$("#J_sidebar_ft");var jqWindow=$(window);$(document).on("click",function(e){var target=$(e.target);var isInBar=target.closest("#J_sidebar").length;
var isCartBtn=target[0]==$("#J_cartAdd_submit")[0];var isInDialog=target.closest("._diaContent").length;var isInDialogBg=target.closest("#_diaBackground").length;if(!isInBar&&(!isCartBtn&&(!isInDialog&&!isInDialogBg))){nsSideBar.util.hideAllCnt();nsSideBar.util.hideLoginCnt();if(nsSideBar.narrow)$("#J_sidebar").addClass("s-sidebarcom")}});jqWindow.on("resize.sbar",function(){var w=jqWindow.width();var h=jqWindow.height();nsSideBar.winWidth=w;if(w<1072){if(!nsSideBar.wrapShow)$(that.el).addClass("s-sidebarcom");
nsSideBar.narrow=true;$(document).on("mousemove.sidebar",that.mosDoc)}else{$(that.el).removeClass("s-sidebarcom");nsSideBar.narrow=false;$(document).off("mousemove.sidebar")}if(h<600)jqSidebarFt.hide();else jqSidebarFt.show()}).trigger("resize.sbar");if($(window).height()<600)jqSidebarFt.hide();else jqSidebarFt.show()},mosDoc:function(e){if(nsSideBar.winWidth-e.clientX<36){if(nsSideBar.narrow){nsSideBar.mosMovT&&clearTimeout(nsSideBar.mosMovT);nsSideBar.mosMovT=setTimeout(function(){$("#J_sidebar").removeClass("s-sidebarcom")},
1500)}}else{nsSideBar.mosMovT&&clearTimeout(nsSideBar.mosMovT);nsSideBar.mosMovT=setTimeout(function(){if(nsSideBar.narrow&&!nsSideBar.wrapShow)$("#J_sidebar").addClass("s-sidebarcom")},600)}},tipManager:function(){if(!rightBarConf.rightBarAssetApi)$.Listeners.pub("couponCount").success({});if(!rightBarConf.rightBarFavBrandApi)$.Listeners.pub("brandCount").success({});$.Listeners.sub("couponCount,brandCount").onsuccess(function(data){var T=new Date;var D=T.getDate();var RUID=$.Cookie.get("VipRUID");
if(data.brandCount&&(!data.brandCount.error&&(data.brandCount.data.data_stat&&data.brandCount.data.data_stat.onsale>0)));else if(data.couponCount&&(data.couponCount.code==0&&data.couponCount.data.num>0)){var brandTip=$.Storage.get("sidebarcom-asset-tip-have");var mark=$.type(brandTip)=="object"?brandTip:{};var txt="\u4f60\u6709\u4f18\u60e0\u5238\u53ef\u4ee5\u7528\u54e6~\u5feb\u6765\u770b\u770b~";mark[RUID]=D;nsSideBar.bao.beckon("#J_asset",txt);$.Storage.set("sidebarcom-asset-tip-have",mark,24*60*
60*2)}})},mosEnter:function(e){var ns=e.data;if(nsSideBar.narrow){ns.leaveT&&clearTimeout(ns.leaveT);$(this).removeClass("s-sidebarcom")}},mosLeave:function(e){var that=this;var ns=e.data;ns.leaveT&&clearTimeout(ns.leaveT);ns.leaveT=setTimeout(function(){if(nsSideBar.narrow&&!nsSideBar.wrapShow)$(that).addClass("s-sidebarcom")},600)},bao:{animQueue:[{step:6,x:[0,5],y:[0]},{step:6,x:[0,5],y:[1]},{step:6,x:[0,5],y:[2]},{step:5,x:[0,4],y:[3]},{step:4,x:[2,5],y:[2]},{step:5,x:[0,4],y:[3]},{step:4,x:[2,
5],y:[2]},{step:5,x:[0,4],y:[3]},{step:75,x:[2],y:[2]},{step:1,x:[5],y:[3]},{step:3,x:[0,2],y:[4]},{step:1,x:[0],y:[0]}],beckon:function(target,msg,notHide){var that=this;var jqBao=$("#J_bao");var jqBaoDialog=$("#J_bao_dialog");var jqDialogTxt="\u4eb2\uff01\u4f60\u6536\u85cf\u7684\u54c1\u724c\u5728\u8fd9\u91cc~";var i=0;var n=0;var x=null;var y=null;var interval=55;jqBao.show();jqBaoDialog.hide();that.bindEvent(target);if(notHide)this.animQueue.length=9;that.t&&clearInterval(that.t);that.t=setInterval(function(){if(n==
that.animQueue.length){clearInterval(that.t);if(!notHide)jqBao.hide();return}var cur=that.animQueue[n];if(x===null){x=cur.x[0];y=cur.y[0]}var X=-2+x*-57+"px";var Y=-2+y*-74+"px";var pos=[X,Y].join(" ");jqBao.css({"background-position":pos});cur.x.length>1&&x++;i++;if(i==cur.step){n++;i=0;x=null;y=null}},interval);if(msg)setTimeout(function(){jqBaoDialog.html(msg).show();setTimeout(function(){if(notHide)jqBaoDialog.html(jqDialogTxt)},3E3)},800)},close:function(){$("#J_bao").hide();$("#J_bao_dialog").hide()},
bindEvent:function(target){var jqWin=$(window);var jqBao=$("#J_bao");var jqBaoDialog=$("#J_bao_dialog");var jqSideBar=$("#J_sidebar");var jqTarget=$(target);var offset=jqTarget.offset();var scrollTop=jqWin.scrollTop();var top=offset.top-scrollTop-16;jqWin.off("resize.sideBao").on("resize.sideBao",function(){jqBao.css({top:top,left:"-55px",position:"absolute"})}).trigger("resize.sideBao");$(jqBao,jqBaoDialog).on("click.sideBao",function(){jqTarget.trigger("click")})}},prepayTip:{el:"#J_sidebar",events:{"click #J-prepay-last-tip-close":"closeTip",
"click #J-prepay-last-tip-go":"closeTip"},init:function(){var that=this;nsSideBar.util.bindEvent(that);that.subEvent()},subEvent:function(){$.Listeners.sub("vip_prePayList").onsuccess(function(re){var RUID=$.Cookie.get("VipRUID");var prepayTip=$.Storage.get("sidebarcom-prepay-tip");var T=new Date;var D=T.getDate();var mark={};mark[RUID]=D;if(VIPSHOP.member.info&&(VIPSHOP.member.info.account&&(typeof VIPTE!="undefined"&&(typeof VIPTE.INDEX!="undefined"&&prepayTip[RUID]!=D)))){if(re.result.length>0)$("#J-prepay-last-tip").show();
$.Storage.set("sidebarcom-prepay-tip",mark,24*60*60)}})},closeTip:function(){$("#J-prepay-last-tip").hide()}},fav:{addFavGoods:function(target,noBeckon){var target=$(target);var offset=target.offset();var top=offset.top;var left=offset.left;if(!VIPSHOP.isIE6&&rightBarConf.rightBarFavGoodsApi){$("#J_fav_point").show();nsSideBar.fav.flyAnim(top,left,noBeckon)}},flyAnim:function(top,left,noBeckon){var that=this;var stars=$('<i class="sidebarcom-fav-tips-ico"></i>');var jqBody=$("body");var jqFav=$("#J_fav");
var jqSbarPopTips=$("#J_fav_all_tip");var jqFavGoodsSuccess=$(".J_fav_goods_success");var targetOffset=jqFav.offset();var targetTop=targetOffset.top;var targetLeft=targetOffset.left;jqBody.append(stars);stars.css({top:top,left:left});stars.animate({top:targetTop,left:targetLeft},"slow",function(){that.starT&&clearTimeout(that.starT);stars.remove();var txt="\u6536\u85cf\u6210\u529f\uff01<br />\u4f60\u6536\u85cf\u7684\u5546\u54c1\u90fd\u5728\u8fd9\u91cc\u54e6\uff01";if(!noBeckon)nsSideBar.bao.beckon("#J_fav",
txt)})}},brand:{addFavBrand:function(target,phone){var target=$(target);var isVisible=target.is(":visible");var oDisplay;var oVisibility;var offset;var top;var left;if(!isVisible){oDisplay=target.css("display");oVisibility=target.css("visibility");target.css({"display":"block","visibility":"hidden"});isVisible=false}offset=target.offset();top=offset.top;left=offset.left;if(!isVisible){target.css({"display":oDisplay,"visibility":oVisibility});target.hide()}if(!isIE6&&rightBarConf.rightBarFavBrandApi)nsSideBar.brand.flyAnim(top,
left,phone)},flyAnim:function(top,left,phone){var that=this;var heart=$('<i class="fly_fav_ico"></i>');var jqBody=$("body");var jqBrand=$("#J_brand");var targetOffset=jqBrand.offset();var targetTop=targetOffset.top;var targetLeft=targetOffset.left;jqBody.append(heart);heart.css({position:"absolute",display:"block",top:top,left:left});heart.animate({top:targetTop,left:targetLeft},"slow",function(){heart.remove();var txt="\u6536\u85cf\u6210\u529f\uff01<br />\u4f60\u6536\u85cf\u7684\u54c1\u724c\u90fd\u5728\u8fd9\u91cc\u54e6\uff01";
var jqSbarBrandPoint=$("#J_sbar_brand_point");nsSideBar.bao.beckon("#J_brand",txt);jqSbarBrandPoint.show()})},addFavShow:function(phone){var that=this;var jqBrandAllTip=$("#J_brand_all_tip");var jqSbarBrandTips=$(".J_sbar_brand_tips");var jqSbarBrandPoint=$("#J_sbar_brand_point");var jqSbarBrandTipClose=$("#J_brand_tip_close");var jqBrandTipSuccess;if(!phone)jqBrandTipSuccess=$("#J_brand_tip_success");else jqBrandTipSuccess=$("#J_brand_tip_phone");jqSbarBrandTips.hide();jqBrandAllTip.show();jqBrandTipSuccess.show();
jqSbarBrandPoint.show();jqSbarBrandTipClose.show();that.addFavT&&clearTimeout(that.addFavT);that.addFavT=setTimeout(function(){jqBrandAllTip.hide();jqBrandTipSuccess.hide()},5E3);jqSbarBrandTipClose.one("click",that.closeTip)},closeTip:function(){$(this).hide();$("#J_brand_all_tip").hide();$("#J_brand_tip_success").hide();$("#J_brand_tip_phone").hide()}},cart:{disposeCartData:function(cb){$.Listeners.pub("headCart.getScript.cartData").success({cb:cb})},reloadHeadCart:function(cartData){$.Listeners.pub("headCart.render.data").success({cartData:cartData})}}};
$(function(){if(!isIE6)$.Loader.advScript({name:"scrollbar",url:VIPSHOP.staticJs+"/plugins/perfect-scrollbar-0.4.8.with-mousewheel.min.js?"+VIPSHOP.jsVer},{name:"scrollbarCb",def:function(){$.Listeners.sub("ready.first").onsuccess(function(){setTimeout(function(){nsSideBar.init();$.Listeners.pub("sidebar.init").success()},1)})},requires:["scrollbar"]})});window.nsSideBar=nsSideBar;$.Listeners.pub("sidebar.loaded").success()},{"./modules/sidebar/nsAssetMod.js":1,"./modules/sidebar/nsBrandV2.js":2,
"./modules/sidebar/nsCartMod.js":3,"./modules/sidebar/nsGoodsV2.js":4,"./modules/sidebar/nsPersonalInfoMod.js":5,"./modules/sidebar/nsSidebarBoPlugin.js":6,"./modules/sidebar/nsSidebarNewCart.js":7,"./modules/sidebar/sidebarConfig.js":8}]},{},[9]);
