!function(){var a="file:"===window.location.protocol||window.location.href.indexOf("local=1")>=0,b=window.location.href.indexOf("daily.taobao.net")>0,c=window.location.protocol,d="https:"===c?"https://assets.alicdn.com/g/tb/login/":"http://g.alicdn.com/tb/login/";KISSY.config({combine:!a&&!b,packages:[{name:"login",tag:"1358514278",path:a?"../build/js/":(b?c+"//assets.daily.taobao.net/g/tb/login":d)+"/0.4.7/js/",charset:"gbk"}]})}(),KISSY.add("login/havana/havanalogin",function(a){var b=function(c){return this instanceof b?(c=c||{},this.vstUrl=c.vstUrl,this.token=c.token,this.applyStUrl=c.applyStUrl,this.miniLoginCheckUrl=c.miniLoginCheckUrl,this.vstData={site:c.site},this.token&&(this.vstData.token=c.token),this.vstParams=a.isArray(c.vstParams)?c.vstParams:null,this.success=a.isFunction(c.success)?c.success:null,this.error=a.isFunction(c.error)?c.error:null,void this._init()):new b(c)};return a.augment(b,{_init:function(){},login:function(b){b=b||{},b.token&&(this.token=this.vstData.token=b.token),this.success=a.isFunction(b.success)?b.success:this.success,this.error=a.isFunction(b.error)?b.error:this.error,(this.success||this.error)&&this._getST()},_login:function(){if(this.vstUrl){var b=this;a.io({url:this.vstUrl,dataType:"jsonp",cache:!1,scriptCharset:"utf-8",timeout:5,data:{st:this.st,params:this._params()},complete:function(c){return c&&c.data&&c.data.url?(window._goldlog_submit_&&window._goldlog_submit_(a.now()),void(b.success&&b.success({url:c.data.url,top:!!c.data.script}))):void(b.error&&b.error(c))}})}},_getST:function(){var b=this;this.getSTURL=this.token?this.applyStUrl:this.miniLoginCheckUrl;var c="stCallback"+a.guid(),d=a.merge(this.vstData,{callback:c}),e=this.getSTURL+(this.getSTURL.indexOf("?")>0?"&":"?")+a.param(d);window[c]=function(a){return b["CALLBACKED_"+c]?void 0:(b["CALLBACKED_"+c]=!0,a&&200===a.code&&a.data&&a.data.st?(b.st=a.data.st,void(b.vstUrl?b._login():b.success&&b.success())):void(b.error&&b.error(a)))},a.getScript(e,{charset:"utf-8",timeout:1,success:function(d){a.log(d),a.later(function(){!b["CALLBACKED_"+c]&&b.error&&(a.log("getscript error"),b["CALLBACKED_"+c]=!0,b.error(d))},100)},error:function(a){b["CALLBACKED_"+c]||(b["CALLBACKED_"+c]=!0,b.error&&b.error(a))}})},_params:function(){if(!this.vstParams||!this.vstParams.length)return"";var b={};return a.each(this.vstParams,function(c){var d=a.one(c);if(d){var e=d.attr("name");if(e){var f="TPL_redirect_url"===e||"allp"===e?window.encodeURIComponent(d.val()):d.val();b[e]=f}}}),a.param(b)}}),b}),KISSY.add("login/havana/sync",function(a){var b=a.require("login/havana/havanalogin"),c=function(a){return this instanceof c?(this.cfg=a||{},this.havanaToken=a.havanaToken,this.gotoURL=a.gotoURL,this.gotoTop=!!a.gotoTop,void this._init()):new c(a)};return a.augment(c,{_init:function(){if(!this.havanaToken)return void this.redirect();var c=this;this.havanalogin=this.havanalogin||b(a.merge({success:function(){c.redirect()},error:function(){c.redirect()}},{applyStUrl:this.cfg.applyStUrl,miniLoginCheckUrl:this.cfg.miniLoginCheckUrl,site:this.cfg.site})),this.havanalogin.login({token:this.havanaToken})},redirect:function(){this.gotoTop?window.top.location.href=this.gotoURL:window.location.href=this.gotoURL}}),c},{requires:["login/havana/havanalogin"]}),KISSY.use("node, ua",function(a){var b=a.one,c=(a.all,a.unparam(window.location.search.slice(1))),d={elLoginBox:b("#J_LoginBox"),elStaticForm:b("#J_StaticForm"),elUserName:b("#TPL_username_1"),elPassword:b("#TPL_password_1"),elEditChk:b("#J_SafeLoginCheck"),elCheckCode:b("#J_CodeInput_i"),elCheckCodeImg:b("#J_StandardCode_m"),elCheckCodeImgHandler:b("#J_StandardCode"),elDynamicForm:b("#J_DynamicForm"),elMobile:b("#J_TPL_mobile_1"),elMobilePwd:b("#J_TPL_PhoneCode_1"),elSSOBox:b("#J_QuickLogin"),bMini:c&&c.style?!!c.style.match(/^(?:mini|b2b)/):!1,from:b("#J_From")?b("#J_From").val():"",bCBU:"3"===(a.one("#J_loginsite")?a.one("#J_loginsite").val():""),bDaily:window.location.host.indexOf("daily.taobao.net")>=0?!0:!1,bHttps:"https:"===window.location.protocol,havanaToken:a.all("#J_HToken").val()},e=window.havanaConfig||{};e.havanaEnable=!!e.enable,a.use("login/havana/sync",function(a,b){b(a.merge(e,d))})});